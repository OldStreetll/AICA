# AICA 功能测试计划 — 基于 FreeCAD 0.19.1 大型项目

> 目的：使用 FreeCAD 0.19.1（~10000 文件的 C++/Python 项目）验证 AICA 插件各项功能的实际效果。
> 测试方法：对比测试 — 用户在 AICA 插件中执行相同 prompt，然后由 Cascade 回答同样问题，逐项对比差异并分析原因。

## 测试环境

| 项目 | 说明 |
|------|------|
| **测试项目** | FreeCAD 0.19.1 源码（`d:\Project\AIConsProject\FreeCAD0191\FreeCAD-0.19.1\`） |
| **项目规模** | ~10000 文件，主要语言 C++/Python |
| **src/ 目录** | App/(148), Base/(162), Gui/(1146), Mod/(7914), 3rdParty/(482), Tools/(83) 等 |
| **AICA 版本** | Sprint 3 完成后（含递归目录、代码定义提取、Diff预览、自动重试、对话持久化） |

## 测试流程

1. 在 Visual Studio 2022 中打开 FreeCAD 0.19.1 解决方案/目录
2. 打开 AICA 工具窗口
3. **每个测试前清空对话**（点 Clear 按钮）
4. 输入指定 prompt，等待 AICA 完整回复
5. 将 AICA 的**完整回复**（包括所有工具调用日志）记录下来
6. 将结果发送给 Cascade 进行对比分析

---

## 测试 1：闲聊守卫

**目标**：验证闲聊消息不触发工具调用

**输入 prompt：**
```
你好
```

**预期行为**：
- ✅ 纯文本友好回复
- ✅ 不调用任何工具（无 🔧 日志）
- ❌ 不应出现 `list_dir`、`read_file` 等工具调用

**检查项**：
- [ ] 回复是否为纯文本
- [ ] 是否有工具调用日志
- [ ] 回复语言是否匹配用户语言（中文）

---

## 测试 2：递归目录列表

**目标**：验证 `list_dir(recursive=true)` 是否被正确使用 + 幻觉文本是否被抑制

**输入 prompt：**
```
列出 src 目录的完整结构
```

**预期行为**：
- ✅ 调用 `list_dir` 并使用 `recursive=true` 参数
- ✅ 不应在调用工具前出现大段幻想的目录描述
- ✅ 基于实际工具返回数据描述结构
- ✅ 结果应包含 App/, Base/, Gui/, Mod/ 等主要目录

**检查项**：
- [ ] 是否使用了 `recursive=true`
- [ ] 工具调用前是否有幻觉文本（>100字的预描述）
- [ ] 目录结构是否准确反映实际文件系统
- [ ] 是否正确排除了 .git, bin, obj 等噪声目录
- [ ] 大型目录（如 Mod/ 有 7914 项）是否被合理截断

---

## 测试 3：代码搜索

**目标**：验证 `grep_search` 在大型项目中的表现

**输入 prompt：**
```
搜索所有包含 "BRep_Builder" 的源文件
```

**预期行为**：
- ✅ 调用 `grep_search` 工具
- ✅ 返回匹配文件列表
- ✅ 结果应包含多个 .cpp/.h 文件

**检查项**：
- [ ] 是否正确调用了 `grep_search`
- [ ] 搜索范围是否合理（整个 src/ 或项目根目录）
- [ ] 返回结果数量是否合理
- [ ] 是否有性能问题（超时或卡顿）
- [ ] 结果描述是否基于实际数据

---

## 测试 4：代码定义提取

**目标**：验证 `list_code_definition_names` 对 C++ 文件的效果

**输入 prompt：**
```
列出 src/App 目录中的代码定义
```

**预期行为**：
- ✅ 调用 `list_code_definition_names` 工具
- ✅ 提取 C++ 类名、函数签名
- ✅ 结果应包含 Application 相关的类和方法

**检查项**：
- [ ] 是否正确调用了 `list_code_definition_names`
- [ ] 提取的定义是否准确（类名、方法名）
- [ ] C++ 代码的正则匹配质量如何
- [ ] 是否受 50 文件上限影响
- [ ] 是否正确处理了 .h 和 .cpp 文件

---

## 测试 5：读文件 + 代码理解

**目标**：验证 `read_file` + LLM 代码分析能力

**输入 prompt：**
```
读取 src/App/Application.h 文件并解释这个类的主要功能
```

**预期行为**：
- ✅ 先调用 `read_file` 读取文件内容
- ✅ 基于实际文件内容进行分析
- ✅ 准确描述 Application 类的功能

**检查项**：
- [ ] 是否先读取文件再分析
- [ ] 分析是否基于文件实际内容
- [ ] 是否准确识别了类的职责和关键方法
- [ ] 如果文件较大，是否正确处理了截断
- [ ] 解释是否专业且准确

---

## 测试 6：综合任务（多步骤推理）

**目标**：验证 Agent 循环、多轮工具调用、attempt_completion

**输入 prompt：**
```
这个项目的构建系统是怎么组织的？请分析 CMakeLists.txt 的结构
```

**预期行为**：
- ✅ 可能需要多次工具调用（`read_file` 顶层 CMakeLists.txt + src/ 下的）
- ✅ Agent 循环应正常工作，不卡在中间
- ✅ 最终调用 `attempt_completion` 或给出完整分析
- ✅ 分析应基于实际文件内容

**检查项**：
- [ ] Agent 进行了几轮工具调用
- [ ] 工具调用顺序是否合理
- [ ] 是否正确识别了 CMake 构建系统的结构
- [ ] 最终分析是否完整且准确
- [ ] 是否正确使用了 `attempt_completion` 结束任务

---

## 对比分析框架

每个测试完成后，按以下维度对比 AICA 回答 vs Cascade 回答：

| 维度 | 说明 |
|------|------|
| **准确性** | 回答内容是否正确 |
| **完整性** | 是否涵盖关键信息 |
| **工具使用** | 是否正确选择和调用了工具 |
| **效率** | 工具调用次数、是否有冗余操作 |
| **幻觉程度** | 是否有编造的内容 |
| **用户体验** | 回复格式、可读性、响应速度 |

## 差异分析模板

```markdown
### 测试 N 对比结果

| 维度 | AICA | Cascade | 差异 |
|------|------|---------|------|
| 准确性 | ? | ? | ? |
| 完整性 | ? | ? | ? |
| 工具使用 | ? | ? | ? |
| 效率 | ? | ? | ? |
| 幻觉程度 | ? | ? | ? |
| 用户体验 | ? | ? | ? |

**可能原因分析：**
1. ...
2. ...

**建议改进：**
1. ...
2. ...
```

---

## 注意事项

- 每次测试前**必须清空对话**，避免上下文污染
- 记录 AICA 的**完整输出**，包括所有 🔧 工具调用日志
- 如果 AICA 出现错误或超时，也请记录错误信息
- FreeCAD 的 src/ 目录很大（10085 项），可能会触发各种边界条件
- 重点关注：幻觉抑制、recursive 参数使用、大文件/大目录处理
